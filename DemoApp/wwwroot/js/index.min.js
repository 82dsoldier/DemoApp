(function(){var i=function(){if($("#DeliveryName").val().length===0){$("#ErrorMessage").html("Please enter a delivery name");return}if($("#DepartureTime").val().length===0){$("#ErrorMessage").html("Please enter a departure time");return}if($("#ReturnTime").val().length===0){$("#ErrorMessage").html("Please ensure you have selected an origin, destination and departure time");return}$.ajax({url:"/deliveries/SaveDelivery",method:"POST",dataType:"JSON",contentType:"application/json",headers:{Accept:"application/json"},data:JSON.stringify({id:0,vehicleId:$("#Vehicles").val(),name:$("#DeliveryName").val(),departureTime:$("#DepartureTime").val(),origin:originId,destination:destId}),complete:function(n){n.status===201?($("#TrackingNumber").val(n.responseJSON.trackingNumber),$("#ErrorMessage").html("Trip successfully saved"),$("#SaveButton").prop("disabled",!0)):$("#ErrorMessage").html("Data was not successfully saved.  Returned error message was"+n.textStatus)}})},n=function(){$.getJSON("/vehicles/getvehicles",function(n){var t=$("#Vehicles");t.empty();$.each(n,function(n,i){t.append($("<option>",{value:i.id}).text(i.name))});t.trigger("chosen:updated")})},t=function(n){return new Promise(function(t,i){var r=new google.maps.places.PlacesService(map);r.getDetails({placeId:n},function(n,r){r===google.maps.places.PlacesServiceStatus.OK?t(n):i(r)})})},r=function(n,t){return new Promise(function(i,r){var u=new google.maps.DirectionsService(map);u.route({origin:{placeId:n},destination:{placeId:t},travelMode:"DRIVING"},function(n,t){t==="OK"?i(n):r(t)})})},u=function(n){$.getJSON("/deliveries/getdeliveriesforvehicle?vehicleId="+n,function(n){var i=0;$.each(n,function(n,u){var f,e,o;t(u.origin).then(function(n){return f=n,t(u.destination)}).then(function(n){return e=n,r(u.origin,u.destination)}).then(function(n){o=n;var t=$("<td>").html('<a href="#" onclick="centerMap('+f.geometry.location.lat()+", "+f.geometry.location.lng()+')"> '+f.name+" <br /> "+f.formatted_address+"<\/a> "),r=$("<td>").html('<a href="#" onclick="centerMap('+e.geometry.location.lat()+","+e.geometry.location.lng()+')">'+e.name+"<br />"+e.formatted_address+"<\/a>"),s=$("<td>").html(formatTime(new Date(u.departureTime))),h=$("<td>").html(formatTime(dateAdd(new Date(u.departureTime),"second",o.routes[0].legs[0].duration.value))),c=$("<td>").html(formatTime(dateAdd(new Date(u.departureTime),"second",o.routes[0].legs[0].duration.value*2)));i=i+o.routes[0].legs[0].duration.value*2;$("#DeliveriesView").find("tbody").append($("<tr>").append($("<td>").html(u.trackingNumber)).append(t).append(r).append(s).append(h).append(c))})})})};$(document).ready(function(){$("#Vehicle").chosen();$("#AddVehicle").fancybox({type:"iframe",iframe:{css:{width:"800px",height:"600px"}},afterClose:function(){n()}});$("#SaveButton").click(function(){i()});$("#ClearButton").click(function(){$("#DeliveryName").val("");$("#DepartureTime").val("");$("#DeliveryTime").val("");$("#ReturnTime").val("");$("#TrackingNumber").val("");$("#origin-input").val("");$("#destination-input").val("");$("#ErrorMessage").html("");$("#SaveButton").prop("disabled",!1);adh.clearRoute();roundTrip="";originId="";destId=""});$("#TripsButton").click(function(){$("#DeliveriesView > tbody").empty();u($("#Vehicles").val())});$("#DepartureTime").datetimepicker();$("#DepartureTime").change(function(){if(tripTime){var n=new Date($("#DepartureTime").val()),t=dateAdd(n,"second",tripTime*2),i=formatTime(dateAdd(n,"second",tripTime)),r=formatTime(t);$("#ReturnTime").val(r);$("#DeliveryTime").val(i)}});n()})})();